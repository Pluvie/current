#!/bin/bash
if [ "$1" == "current" ]; then
  mkdir -p lib                      &&
  gcc src/current.c                 \
    $(find src/current -name "*.c"  \
      | tr '\n' ' ')                \
    -include "def/current.h"        \
    -Wall                           \
    -Wno-unused-label               \
    -Werror                         \
    -shared                         \
    -o lib/libcurrent.so
elif [ "$1" == "benchmark" ]; then
  gcc src/benchmark.c               \
    $(find src/benchmark -name "*.c"\
      | tr '\n' ' ')                \
    -include "def/current.h"        \
    -include "def/benchmark.h"      \
    -L lib/                         \
    -lcurrent                       \
    -Wall                           \
    -Wno-unused-label               \
    -Werror                         \
    ${@:2}
elif [ "$1" == "benchmark-local" ]; then
  gcc src/benchmark.c               \
    $(find src/current -name "*.c"  \
      | tr '\n' ' ')                \
    $(find src/benchmark -name "*.c"\
      | tr '\n' ' ')                \
    -include "def/current.h"        \
    -include "def/benchmark.h"      \
    -Wall                           \
    -Wno-unused-label               \
    -Werror                         \
    ${@:2}
elif [ "$1" == "test" ]; then
  gcc src/test.c                    \
    $(find src/current -name "*.c"  \
      | tr '\n' ' ')                \
    $(find def/test -name "*.c"     \
      | tr '\n' ' ')                \
    $(find src/test -name "*.c"     \
      | tr '\n' ' ')                \
    -include "def/current.h"        \
    -include "def/test.h"           \
    -Wall                           \
    -Wno-unused-label               \
    -Werror                         \
    -g                              \
    ${@:2}
else
  echo "Unrecognized compilation output: $1."
  echo "Supported outputs are: 'current', 'benchmark', 'benchmark-local' or 'test'."
fi
